import joblib
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier

# ‚úÖ **T·∫°o d·ªØ li·ªáu gi·∫£ l·∫≠p**
data = {
    'Tu·ªïi': np.random.randint(30, 80, 1000),  # Tu·ªïi t·ª´ 30 ƒë·∫øn 80
    'H√∫t thu·ªëc': np.random.randint(0, 2, 1000),  # 0: Kh√¥ng h√∫t, 1: C√≥ h√∫t thu·ªëc
    'Ho m√£n t√≠nh': np.random.randint(0, 2, 1000),
    'Kh√≥ th·ªü': np.random.randint(0, 2, 1000),
    'ƒêau ng·ª±c': np.random.randint(0, 2, 1000),
    'Ti·ªÅn s·ª≠ gia ƒë√¨nh': np.random.randint(0, 2, 1000),
    'Ung th∆∞ ph·ªïi': np.random.choice([0, 1, 2, 3], size=1000, p=[0.2, 0.3, 0.3, 0.2])  # 0: Kh√¥ng c√≥, 1-3: M·ª©c ƒë·ªô nghi√™m tr·ªçng
}

df = pd.DataFrame(data)

# ‚úÖ **ƒêi·ªÅu ch·ªânh d·ªØ li·ªáu ƒë·ªÉ m√¥ ph·ªèng nguy c∆° ung th∆∞ ph·ªïi th·ª±c t·∫ø**
df.loc[df['Tu·ªïi'] > 60, 'Ung th∆∞ ph·ªïi'] = 1
df.loc[(df['H√∫t thu·ªëc'] == 1) & (df['Ho m√£n t√≠nh'] == 1), 'Ung th∆∞ ph·ªïi'] = 1
df.loc[(df['Kh√≥ th·ªü'] == 1) & (df['ƒêau ng·ª±c'] == 1), 'Ung th∆∞ ph·ªïi'] = 1
df.loc[(df['Tu·ªïi'] > 50) & (df['H√∫t thu·ªëc'] == 1) & (df['Ho m√£n t√≠nh'] == 0), 'Ung th∆∞ ph·ªïi'] = 2
df.loc[(df['Tu·ªïi'] <= 50) & (df['H√∫t thu·ªëc'] == 0), 'Ung th∆∞ ph·ªïi'] = 3
df.loc[(df['H√∫t thu·ªëc'] == 0) & (df['Ho m√£n t√≠nh'] == 0) & (df['Kh√≥ th·ªü'] == 0) & 
       (df['ƒêau ng·ª±c'] == 0) & (df['Ti·ªÅn s·ª≠ gia ƒë√¨nh'] == 0), 'Ung th∆∞ ph·ªïi'] = 4

# ‚úÖ **T√°ch d·ªØ li·ªáu th√†nh t·∫≠p hu·∫•n luy·ªán v√† t·∫≠p ki·ªÉm tra**
X = df.drop(columns=['Ung th∆∞ ph·ªïi'])  # ƒê·∫ßu v√†o (features)
y = df['Ung th∆∞ ph·ªïi']  # Nh√£n ƒë·∫ßu ra (labels)

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)

# ‚úÖ **Hu·∫•n luy·ªán m√¥ h√¨nh Random Forest**
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

# ‚úÖ **L∆∞u m√¥ h√¨nh l·∫°i sau khi hu·∫•n luy·ªán**
joblib.dump(model, 'lung_cancer_model.pkl')

print("üéâ M√¥ h√¨nh ƒë√£ ƒë∆∞·ª£c hu·∫•n luy·ªán v√† l∆∞u th√†nh c√¥ng v√†o 'lung_cancer_model.pkl'!")
